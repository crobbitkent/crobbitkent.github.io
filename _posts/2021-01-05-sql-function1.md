---
layout: post
title:  "SQL 공부 - 함수(1)"
date:   2020-01-05
---

— 오라클에서 자체적으로 제공하는 함수에 대해 알아보자.

— 오라클의 함수는 크게 두 가지로 분류한다.

— 1. 단일 행 함수 2. GROUP 함수

— 공통점은 모두 ROW 하나를 결과로 반환한다.

— 차이점은 단일 행 함수는  하나의 행 값이 함수에 적용되어 하나의 행이 리턴

— GROUP 함수는 하나 이상의 행 값이 적용되어 하나의 행이 리턴

— 단일 행 함수의 예는 SUBSTR이다. 함수를 적용할 때나 안 할 때나 리턴되는 ROW의 수가 같다.

— 반면, GROUP BY하면 컬럼의 값 별로 하나씩 결과를 돌려준다.

#### 1. 문자함수

— 1-1. INSTR : 문자열에서 지정한 문자가 위치하는 첫번째 자리 수를 반환

— INSTR은 문자 단위로 처리되는 함수이며, INSTRB는 BYTES 단위로 처리되는 함수이다.

— **사용법 : 'ABC좋은나라DEF웃긴나라' 라는 문자열을 이용해 'D'와 '나' 문자가 위치하는 자리 수를 읽어보자.**

>SELECT INSTR('ABC좋은나라DEF웃긴나라' , 'D'),  
INSTR('ABC좋은나라DEF웃긴나라', '나')  
FROM DUAL;  

— 'D'의 자리 수는 8이며 '나'의 자리 수는 6이다.

— **사용법2 : INSTRB를 사용해보자.**

>SELECT INSTRB('ABC좋은나라DEF웃긴나라' , 'D'),  
INSTRB('ABC좋은나라DEF웃긴나라' , '나')  
FROM DUAL;  

— 12, 8이 나온다. 한글 하나를 2 BYTES로 인식하여 ABC→3, 좋은→4이다. 따라서 '나' 는 8번째이다. (내가 직접 해본 것은 한글이 3 BYTES, 따라서 16, 10이 나왔다)

— **사용법3 : 이번에는 문자열에서 두 번째로 나오는 '나'의 위치를 알아보자.**

>SELECT INSTR('ABC좋은나라DEF웃긴나라' , '나', 1, 2)  
 FROM DUAL;  

— 결과 : 13

— 1은 문자열의 시작점, 2는 2번째 나오는 '나'를 검색하라는 뜻이다. 이렇게 해도 값은 같다.

>SELECT INSTR('ABC좋은나라DEF웃긴나라', '나', 7, 1)  
FROM DUAL;  

— 없는 문자인 '다'를 검색하면 어떻게 될까?

>SELECT INSTR('ABC좋은나라DEF웃긴나라', '다')  
FROM DUAL;  

— <알아두기 : DUAL TABLE 이란?>

— DUAL TABLE은 SYS USER가 소유하고 있는 단일 행에 단일 컬럼만을 가지는 테이블이다.

— 주 용도는 일시적 산술 연산이나 날짜 연산을 위하여 사용한다.

— 1장에서 SEELCT문을 통한 산술 연산을 설명했는데, 연산 결과가 나오는 것도 SELECT를 통해 하다 보니 FROM절에 기술된 테이블에 존재하는 ROW 수 만큼 나오게 된 것이다.

— 산술 연산을 한 결과가 나오는데 테이블에 있는 RECORD 수 만큼 동일한 결과가 뿌려지면 알아보기 어려울 것이다.

— 산술연산을 할 때마다 조건을 맞게 줘서 한 행씩만 나오게 하자니 비용이 크고 불편하다. 그래서 한 행만을 가진 DUAL TABLE을 사용하는 것이다.

— <알아두기 끝>

— **2. SUBSTR**

— 문자열에서 철번째 지정된 숫자에 해당하는 자리부터 두 번째 지정된 숫자에 해당하는 만큼의 문자열을 돌려 준다. 

— 두 번째 숫자가 생략되면 마지막 문자까지를 돌려 주게 된다. INSTRB와 마찬가지로 SUBSTRB가 존재한다.

— **사용법** : 'ABC좋은나라DEF웃긴나라' 문자열의 두 번째부터 10 개의 문자열을 읽어보자

>SELECT SUBSTR('ABC좋은나라DEF웃긴나라', 2, 10)  
FROM DUAL;  

— 결과 : BC좋은나라DEF웃

— **사용법2** : SUBSTRB를 사용해보자.

>SELECT SUBSTRB('ABC좋은나라DEF웃긴나라', 2, 10)  
FROM DUAL;  

— 결과 : BC좋은

— 즉, 데이터가 도중에 짤리면 값은 나오지 않는다.

— **퀴즈** : 'ABC좋은나라DEF웃긴나라'에서 좋은 나라만 잘라보자.

>SELECT SUBSTR('ABC좋은나라DEF웃긴나라', 4, 4)  
FROM DUAL;  

>SELECT SUBSTRB('ABC좋은나라DEF웃긴나라', 4, 12)  
FROM DUAL;  

— **3.** LENGTH : 주어진 문자열의 길이를 돌려 준다.

— **사용법** : 'ABC좋은나라DEF웃긴나라'의 길이를 알아보자

>SELECT LENGTH('ABC좋은나라DEF웃긴나라')  
FROM DUAL;  

>SELECT LENGTHB('ABC좋은나라DEF웃긴나라')  
FROM DUAL;  

— 결과 : 22가 아닌 30이 나온다. (1 * 6 + 3 * 8). 한글은 3BYTE

— **사용법2** : 문자열 내에 존재하는 한글이 몇 글자인지 알아내보자.

>SELECT (LENGTHB('ABC좋은나라DEF웃긴나라')  
-LENGTH('ABC좋은나라DEF웃긴나라')) / 2  
FROM DUAL;  

— 결과 : 8